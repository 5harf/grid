!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require){angular.module("riq-grid",[require("./angular-decorator").name]).factory("RiqGridSrvc",function(){return{core:require("./core")}})},{"./angular-decorator":13,"./core":20}],2:[function(require,module){module.exports=function(string){return string.charAt(0).toUpperCase()+string.substring(1)},module.exports.words=function(string){return string.replace(/(^|\W)(\w)/g,function(m){return m.toUpperCase()})}},{}],3:[function(require,module){function ElementClass(opts){if(!(this instanceof ElementClass))return new ElementClass(opts);opts||(opts={}),opts.nodeType&&(opts={el:opts}),this.opts=opts,this.el=opts.el||document.body,"object"!=typeof this.el&&(this.el=document.querySelector(this.el))}module.exports=function(opts){return new ElementClass(opts)},ElementClass.prototype.add=function(className){var el=this.el;if(el){if(""===el.className)return el.className=className;var classes=el.className.split(" ");return classes.indexOf(className)>-1?classes:(classes.push(className),el.className=classes.join(" "),classes)}},ElementClass.prototype.remove=function(className){var el=this.el;if(el&&""!==el.className){var classes=el.className.split(" "),idx=classes.indexOf(className);return idx>-1&&classes.splice(idx,1),el.className=classes.join(" "),classes}},ElementClass.prototype.has=function(className){var el=this.el;if(el){var classes=el.className.split(" ");return classes.indexOf(className)>-1}}},{}],4:[function(require,module){(function(){"use strict";var alnum,ref;ref=require("../ref").ref,alnum={0:ref("0",48),1:ref("1",49),2:ref("2",50),3:ref("3",51),4:ref("4",52),5:ref("5",53),6:ref("6",54),7:ref("7",55),8:ref("8",56),9:ref("9",57),a:ref("A",65),b:ref("B",66),c:ref("C",67),d:ref("D",68),e:ref("E",69),f:ref("F",70),g:ref("G",71),h:ref("H",72),i:ref("I",73),j:ref("J",74),k:ref("K",75),l:ref("L",76),m:ref("M",77),n:ref("N",78),o:ref("O",79),p:ref("P",80),q:ref("Q",81),r:ref("R",82),s:ref("S",83),t:ref("T",84),u:ref("U",85),v:ref("V",86),w:ref("W",87),x:ref("X",88),y:ref("Y",89),z:ref("Z",90)},module.exports=alnum}).call(this)},{"../ref":10}],5:[function(require,module){(function(){"use strict";var arrow,ref;ref=require("../ref").ref,arrow={left:ref("Left",37),up:ref("Up",38),right:ref("Right",39),down:ref("Down",40)},module.exports=arrow}).call(this)},{"../ref":10}],6:[function(require,module){(function(){"use strict";var brand,ref;ref=require("../ref").ref,brand={apple:ref("Apple &#8984;",224),windows:{start:ref("Windows start",[91,92]),menu:ref("Windows menu",93)}},module.exports=brand}).call(this)},{"../ref":10}],7:[function(require,module){(function(){"use strict";var punctuation,ref;ref=require("../ref").ref,punctuation={colon:ref("Colon/Semicolon",[59,186]),equal:ref("Equal/Plus",[61,187]),comma:ref("Comma/Less Than",[44,188]),hyphen:ref("Hyphen/Underscore",[45,109,189]),period:ref("Period/Greater Than",[46,190]),tilde:ref("Tilde/Back Tick",[96,192]),apostrophe:ref("Apostrophe/Quote",[39,222]),slash:{forward:ref("Forward Slash/Question Mark",[47,191]),backward:ref("Backward Slash/Pipe",220)},brace:{square:{open:ref("Open Square/Curly Brace",219),close:ref("Close Square/Curly Brace",221)}}},punctuation.semicolon=punctuation.colon,punctuation.plus=punctuation.equal,punctuation.lessthan=punctuation.comma,punctuation.underscore=punctuation.hyphen,punctuation.greaterthan=punctuation.period,punctuation.question=punctuation.slash.forward,punctuation.backtick=punctuation.tilde,punctuation.pipe=punctuation.slash.backward,punctuation.quote=punctuation.apostrophe,punctuation.brace.curly=punctuation.brace.square,module.exports=punctuation}).call(this)},{"../ref":10}],8:[function(require,module){(function(){"use strict";var ref,special;ref=require("../ref").ref,special={backspace:ref("Backspace",8),tab:ref("Tab",9),enter:ref("Enter",13),shift:ref("Shift",16),ctrl:ref("Ctrl",17),alt:ref("Alt",18),caps:ref("Caps Lock",20),esc:ref("Escape",27),space:ref("Space",32),num:ref("Num Lock",144)},module.exports=special}).call(this)},{"../ref":10}],9:[function(require,module){(function(){"use strict";var isRef,iterator,key,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty;isRef=require("./ref").isRef,key={},key.code={special:require("./code/special"),arrow:require("./code/arrow"),punctuation:require("./code/punctuation"),alnum:require("./code/alnum"),brand:require("./code/brand")},key.get=function(pressed){return iterator(key.code,pressed)},key.is=function(ref,pressed){return isRef(ref)||(ref=iterator(ref,pressed)),isRef(ref)?isRef(pressed)?pressed===ref:pressed===ref.code||__indexOf.call(ref.code,pressed)>=0:pressed===ref},iterator=function(context,pressed){var i,out,ref;for(i in context)if(__hasProp.call(context,i))if(ref=context[i],isRef(ref)){if(key.is(ref,pressed))return ref}else if(out=iterator(ref,pressed),isRef(out))return out},"undefined"!=typeof window&&(window.key=key),module.exports=key}).call(this)},{"./code/alnum":4,"./code/arrow":5,"./code/brand":6,"./code/punctuation":7,"./code/special":8,"./ref":10}],10:[function(require,module){(function(){"use strict";var Reference,assertRef,isRef,ref;Reference=function(){function Reference(name,code){this.name=name,this.code=code}return Reference}(),ref=function(name,code){return new Reference(name,code)},isRef=function(ref){return ref instanceof Reference},assertRef=function(ref){if(!isRef(ref))throw new Error("Invalid reference");return ref},module.exports={ref:ref,isRef:isRef,assertRef:assertRef}}).call(this)},{}],11:[function(require,module){var addDirtyProps=require("../add-dirty-props"),util=require("../util"),noop=require("../no-op");module.exports=function(_grid,name,lengthName,defaultSize){function setDescriptorsDirty(eventOptional){var event=eventOptional||{};event.type="grid-"+name+"-change",grid.eventLoop.fire(event),dirtyClean.setDirty(),builderDirtyClean.setDirty()}function fireSelectionChange(){grid.eventLoop.fire("grid-"+name+"-selection-change")}function updateDescriptorIndices(){descriptors.forEach(function(descriptor,i){descriptor.index=i})}var grid=_grid,descriptors=[],numFixed=0,numHeaders=0,makeDirtyClean=require("../dirty-clean"),dirtyClean=makeDirtyClean(grid),builderDirtyClean=makeDirtyClean(grid),selected=[],api={areBuildersDirty:builderDirtyClean.isDirty,isDirty:dirtyClean.isDirty,defaultSize:defaultSize,add:function(toAdd){util.isArray(toAdd)||(toAdd=[toAdd]),toAdd.forEach(function(descriptor){if(descriptor.header)descriptors.splice(numHeaders,0,descriptor),numFixed++,numHeaders++;else{if(descriptor.fixed){if(descriptors.length&&!descriptors[descriptors.length-1].fixed)throw"Cannot add a fixed column after an unfixed one";numFixed++}descriptors.push(descriptor)}}),updateDescriptorIndices(),setDescriptorsDirty({action:"add",descriptors:toAdd})},addHeaders:function(toAdd){util.isArray(toAdd)||(toAdd=[toAdd]),toAdd.forEach(function(header){header.header=!0}),api.add(toAdd)},header:function(index){return descriptors[index]},get:function(index){return descriptors[index]},length:function(includeHeaders){var subtract=includeHeaders?0:numHeaders;return descriptors.length-subtract},remove:function(descriptor,dontUpdateIndex){var index=descriptors.indexOf(descriptor);-1!==index&&(descriptors.splice(index,1),descriptor.header?(numFixed--,numHeaders--):descriptor.fixed&&numFixed--),dontUpdateIndex||updateDescriptorIndices()},clear:function(includeHeaders){descriptors.slice(0).forEach(function(descriptor){(includeHeaders||!descriptor.header)&&api.remove(descriptor,!0)})},move:function(start,target){descriptors.splice(target,0,descriptors.splice(start,1)[0]),updateDescriptorIndices(),setDescriptorsDirty({action:"move",descriptors:[api.get(start),api.get(target)]})},numHeaders:function(){return numHeaders},numFixed:function(){return numFixed},toVirtual:function(dataIndex){return dataIndex+api.numHeaders()},toData:function(virtualIndex){return virtualIndex-api.numHeaders()},select:function(index){var descriptor=api[name](index);descriptor.selected||(descriptor.selected=!0,selected.push(index),fireSelectionChange())},deselect:function(index,dontNotify){var descriptor=api[name](index);descriptor.selected&&(descriptor.selected=!1,selected.splice(selected.indexOf(index),1),dontNotify||fireSelectionChange())},toggleSelect:function(index){var descriptor=api[name](index);descriptor.selected?api.deselect(index):api.select(index)},clearSelected:function(){var length=selected.length;selected.slice(0).forEach(function(index){api.deselect(index,!0)}),length&&fireSelectionChange()},getSelected:function(){return selected},create:function(builder){var descriptor={},fixed=!1;return Object.defineProperty(descriptor,"fixed",{enumerable:!0,get:function(){return descriptor.header||fixed},set:function(_fixed){fixed=_fixed}}),addDirtyProps(descriptor,["builder"],[builderDirtyClean]),descriptor.builder=builder,addDirtyProps(descriptor,[{name:lengthName,onDirty:function(){setDescriptorsDirty({action:"size",descriptors:[descriptor]})}},{name:"hidden",onDirty:function(){setDescriptorsDirty({action:"hide",descriptors:[descriptor]})}}],[dirtyClean])},createBuilder:function(render,update){return{render:render||noop,update:update||noop}}};return api[lengthName]=function(index){var descriptor=descriptors[index];return descriptor?descriptor.hidden?0:descriptor[lengthName]||api.defaultSize:0/0},api[name]=function(index){return descriptors[index+numHeaders]},api}},{"../add-dirty-props":12,"../dirty-clean":24,"../no-op":30,"../util":37}],12:[function(require,module){module.exports=function(obj,props,dirtyCleans){return props.forEach(function(prop){var val,name=prop.name||prop;Object.defineProperty(obj,name,{enumerable:!0,get:function(){return val},set:function(_val){var isChanged=_val!==val;val=_val,isChanged&&(dirtyCleans.forEach(function(dirtyClean){dirtyClean.setDirty()}),prop.onDirty&&prop.onDirty())}})}),obj}},{}],13:[function(require,module){module.exports=angular.module("grid-decorator",[]).factory("GridDecoratorSrvc",["$compile",function($compile){return{render:function(opts){var compiled=$compile(opts.template)(opts.$scope);return compiled.on("decorator-destroy",function(){opts.$scope.$destroy(),setTimeout(function(){compiled.off("decorator-destroy")},1)}),opts.$scope.$apply(),compiled[0]}}}])},{}],14:[function(require,module){var positionRange=require("../position-range"),makeDirtyClean=require("../dirty-clean"),addDirtyProps=require("../add-dirty-props");module.exports=function(_grid){var grid=_grid,dirtyClean=makeDirtyClean(grid),descriptors=[],api={add:function(descriptor){descriptors.push(descriptor),dirtyClean.setDirty()},remove:function(descriptor){descriptors.splice(descriptors.indexOf(descriptor),1),dirtyClean.setDirty()},getAll:function(){return descriptors.slice(0)},create:function(top,left,className,height,width,space){var thisDirtyClean=makeDirtyClean(grid),descriptor={};return positionRange(descriptor,thisDirtyClean,dirtyClean),addDirtyProps(descriptor,["class"],[thisDirtyClean,dirtyClean]),descriptor.top=top,descriptor.left=left,descriptor.height=height||1,descriptor.width=width||1,descriptor.class=className,descriptor.space=space||descriptor.space,descriptor},isDirty:dirtyClean.isDirty};return api}},{"../add-dirty-props":12,"../dirty-clean":24,"../position-range":32}],15:[function(require,module){var customEvent=require("../custom-event"),PROPS_TO_COPY_FROM_MOUSE_EVENTS=["clientX","clientY","gridX","gridY","layerX","layerY","row","col","realRow","realCol"];module.exports=function(_grid){function setupDragEventForMouseDown(downEvent){function handleMouseUp(e){unbindMove(),unbindUp();var dragEnd=createDragEventFromMouseEvent("grid-drag-end",e);grid.eventLoop.fire(dragEnd)}wasDragged=!1;var lastDragRow=downEvent.row,lastDragCol=downEvent.col,dragStarted=!1,unbindMove=grid.eventLoop.bind("mousemove",window,function(e){return dragStarted&&!e.which?(console.log("mousemove unbind, how on earth do these happen?"),void handleMouseUp(e)):(dragStarted||(wasDragged=!0,createAndFireDragEvent("grid-drag-start",downEvent),dragStarted=!0),createAndFireDragEvent("grid-drag",e),void((e.row!==lastDragRow||e.col!==lastDragCol)&&(createAndFireDragEvent("grid-cell-drag",e),lastDragRow=e.row,lastDragCol=e.col)))}),unbindUp=grid.eventLoop.bind("mouseup",window,handleMouseUp)}function createDragEventFromMouseEvent(type,e){var event=customEvent(type,!0,!0);return PROPS_TO_COPY_FROM_MOUSE_EVENTS.forEach(function(prop){event[prop]=e[prop]}),event.originalEvent=e,event}function createAndFireDragEvent(type,e){var drag=createDragEventFromMouseEvent(type,e);return e.target?e.target.dispatchEvent(drag):grid.eventLoop.fire(drag),drag}var grid=_grid,model={},wasDragged=!1;return model._annotateEvent=function(e){switch(e.type){case"click":e.wasDragged=wasDragged;case"mousedown":case"mousemove":case"mouseup":case"dblclick":model._annotateEventInternal(e)}},model._annotateEventFromViewCoords=function(e,viewRow,viewCol){e.realRow=viewRow,e.realCol=viewCol,e.virtualRow=grid.viewPort.toVirtualRow(e.realRow),e.virtualCol=grid.viewPort.toVirtualCol(e.realCol),e.row=e.virtualRow-grid.rowModel.numHeaders(),e.col=e.virtualCol-grid.colModel.numHeaders()},model._annotateEventInternal=function(e){var y=grid.viewPort.toGridY(e.clientY),x=grid.viewPort.toGridX(e.clientX),viewRow=grid.viewPort.getRowByTop(y),viewCol=grid.viewPort.getColByLeft(x);model._annotateEventFromViewCoords(e,viewRow,viewCol),e.gridX=x,e.gridY=y},grid.eventLoop.addInterceptor(function(e){model._annotateEvent(e),"mousedown"===e.type&&setupDragEventForMouseDown(e)}),model}},{"../custom-event":21}],16:[function(require,module){var util=require("../util");module.exports=function(_grid){function convertVirtualToScroll(virtualCoord,rowOrCol){return virtualCoord-grid[rowOrCol+"Model"].numFixed()}function getScrollToRowOrCol(virtualCoord,rowOrCol,heightWidth){var currentScroll=model[rowOrCol],scrollTo=currentScroll;if(grid.viewPort[rowOrCol+"IsInView"](virtualCoord))return scrollTo;var targetScroll=convertVirtualToScroll(virtualCoord,rowOrCol);if(currentScroll>targetScroll)scrollTo=targetScroll;else if(targetScroll>currentScroll){var lengthToCell=grid.virtualPixelCellModel[heightWidth](0,virtualCoord),numFixed=grid[rowOrCol+"Model"].numFixed();scrollTo=0;for(var i=numFixed;virtualCoord>i&&(lengthToCell-=grid.virtualPixelCellModel[heightWidth](i),scrollTo=i-(numFixed-1),!(lengthToCell<=grid.viewPort[heightWidth]));i++);}return scrollTo}var row,grid=_grid,dirtyClean=require("../dirty-clean")(grid),model={col:0};return Object.defineProperty(model,"row",{enumerable:!0,get:function(){return row},set:function(r){row=r}}),model.row=0,model.isDirty=dirtyClean.isDirty,model.scrollTo=function(r,c,dontFire,fromPixelModel){if(!isNaN(r)&&!isNaN(c)){var maxRow=(grid.rowModel.length()||1)-1,maxCol=(grid.colModel.length()||1)-1,lastRow=model.row,lastCol=model.col;if(model.row=util.clamp(r,0,maxRow),model.col=util.clamp(c,0,maxCol),(lastRow!==model.row||lastCol!==model.col)&&(dirtyClean.setDirty(),dontFire||grid.eventLoop.fire("grid-cell-scroll"),!fromPixelModel)){var top=grid.virtualPixelCellModel.height(0,model.row-1),left=grid.virtualPixelCellModel.width(0,model.col-1);grid.pixelScrollModel.scrollTo(top,left,!0)}}},model.scrollIntoView=function(vr,vc){vr=grid.virtualPixelCellModel.clampRow(vr),vc=grid.virtualPixelCellModel.clampCol(vc);var newRow=getScrollToRowOrCol(vr,"row","height"),newCol=getScrollToRowOrCol(vc,"col","width");model.scrollTo(newRow,newCol)},model}},{"../dirty-clean":24,"../util":37}],17:[function(require,module){module.exports=function(_grid){var grid=_grid,api=require("../abstract-row-col-model")(grid,"col","width",100);return api}},{"../abstract-row-col-model":11}],18:[function(require,module){var elementClass=require("element-class"),util=require("../util");module.exports=function(_grid){function makeReorderDecorator(headerDecorator){var col=headerDecorator.left;return headerDecorator._dragRect=grid.decorators.create(0,void 0,1/0,void 0,"px","real"),headerDecorator._dragRect.postRender=function(div){div.setAttribute("class","grid-drag-rect")},headerDecorator._onDragStart=function(e){if(!(e.realCol<grid.colModel.numFixed())){grid.decorators.add(headerDecorator._dragRect),headerDecorator._dragRect.width=grid.viewPort.getColWidth(col);var colOffset=e.gridX-headerDecorator.getDecoratorLeft();headerDecorator._dragRect._targetCol=grid.decorators.create(0,void 0,1/0,1,"cell","real"),headerDecorator._dragRect._targetCol.postRender=function(div){div.setAttribute("class","grid-reorder-target"),headerDecorator._dragRect._targetCol._renderedElem=div},grid.decorators.add(headerDecorator._dragRect._targetCol),headerDecorator._unbindDrag=grid.eventLoop.bind("grid-drag",function(e){headerDecorator._dragRect.left=util.clamp(e.gridX-colOffset,grid.viewPort.getColLeft(grid.colModel.numFixed()),1/0),headerDecorator._dragRect._targetCol.left=util.clamp(e.realCol,grid.colModel.numFixed(),1/0),e.realCol>col?elementClass(headerDecorator._dragRect._targetCol._renderedElem).add("right"):elementClass(headerDecorator._dragRect._targetCol._renderedElem).remove("right")}),headerDecorator._unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(){var targetCol=headerDecorator._dragRect._targetCol.left;grid.colModel.move(grid.viewPort.toVirtualCol(col),grid.viewPort.toVirtualCol(targetCol)),grid.decorators.remove([headerDecorator._dragRect._targetCol,headerDecorator._dragRect]),headerDecorator._unbindDrag(),headerDecorator._unbindDragEnd()})}},headerDecorator.postRender=function(div){div.setAttribute("class","grid-col-reorder"),grid.eventLoop.bind("grid-drag-start",div,headerDecorator._onDragStart)},headerDecorator}var grid=_grid,api={annotateDecorator:makeReorderDecorator};return require("../header-decorators")(grid,api),api}},{"../header-decorators":26,"../util":37,"element-class":3}],19:[function(require,module){module.exports=function(_grid){function annotateDecorator(headerDecorator){var col=headerDecorator.left;headerDecorator._dragLine=grid.decorators.create(0,void 0,1/0,1,"px","real"),headerDecorator._dragLine.postRender=function(div){div.setAttribute("class","grid-drag-line")},headerDecorator._onDragStart=function(){grid.decorators.add(headerDecorator._dragLine),headerDecorator._unbindDrag=grid.eventLoop.bind("grid-drag",function(e){var minX=headerDecorator.getDecoratorLeft()+10;headerDecorator._dragLine.left=Math.max(e.gridX,minX)}),headerDecorator._unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(){grid.colModel.get(grid.viewPort.toVirtualCol(col)).width=headerDecorator._dragLine.left-headerDecorator.getDecoratorLeft(),grid.decorators.remove(headerDecorator._dragLine),headerDecorator._unbindDrag(),headerDecorator._unbindDragEnd()})},headerDecorator.postRender=function(div){div.style.transform="translateX(50%)",div.style.webkitTransform="translateX(50%)",div.style.removeProperty("left"),div.setAttribute("class","col-resize"),grid.eventLoop.bind("grid-drag-start",div,headerDecorator._onDragStart)}}var grid=_grid,api={annotateDecorator:annotateDecorator};return require("../header-decorators")(grid,api),api}},{"../header-decorators":26}],20:[function(require,module){var elementClass=require("element-class"),dirtyClean=require("../dirty-clean");module.exports=function(){function createFocusTextArea(container){var textarea=document.createElement("textarea");return textarea.setAttribute("dts","grid-textarea"),textarea.style.position="fixed",textarea.style.left="-100000px",textarea.addEventListener("focus",function(){container&&elementClass(container).add("focus"),textarea.select()}),textarea.addEventListener("blur",function(){container&&elementClass(container).remove("focus")}),container.appendChild(textarea),container.getAttribute("tabIndex")||(container.tabIndex=-1),container.addEventListener("focus",function(){textarea&&textarea.focus()}),textarea}var grid={};grid.eventLoop=require("../event-loop")(grid),grid.decorators=require("../decorators")(grid),grid.cellClasses=require("../cell-classes")(grid),grid.rowModel=require("../row-model")(grid),grid.colModel=require("../col-model")(grid),grid.dataModel=require("../simple-data-model")(grid),grid.virtualPixelCellModel=require("../virtual-pixel-cell-model")(grid),grid.cellScrollModel=require("../cell-scroll-model")(grid),grid.cellMouseModel=require("../cell-mouse-model")(grid),grid.viewPort=require("../view-port")(grid),grid.viewLayer=require("../view-layer")(grid),grid.navigationModel=require("../navigation-model")(grid),grid.pixelScrollModel=require("../pixel-scroll-model")(grid),grid.colResize=require("../col-resize")(grid),grid.colReorder=require("../col-reorder")(grid),grid.showHiddenCols=require("../show-hidden-cols")(grid);var drawRequested=!1;return grid.requestDraw=function(){grid.eventLoop.isRunning?drawRequested=!0:grid.viewLayer.draw()},grid.eventLoop.bind("grid-draw",function(){drawRequested=!1}),grid.eventLoop.addExitListener(function(){drawRequested&&grid.viewLayer.draw()}),grid.build=function(container){grid.textarea=createFocusTextArea(container),grid.viewPort.sizeToContainer(container),grid.viewLayer.build(container),grid.eventLoop.setContainer(container)},grid.makeDirtyClean=function(){return dirtyClean(grid)},grid}},{"../cell-classes":14,"../cell-mouse-model":15,"../cell-scroll-model":16,"../col-model":17,"../col-reorder":18,"../col-resize":19,"../decorators":23,"../dirty-clean":24,"../event-loop":25,"../navigation-model":29,"../pixel-scroll-model":31,"../row-model":34,"../show-hidden-cols":35,"../simple-data-model":36,"../view-layer":38,"../view-port":39,"../virtual-pixel-cell-model":40,"element-class":3}],21:[function(require,module){module.exports=function(name,bubbles,cancelable,detail){var event=document.createEvent("CustomEvent");return event.initCustomEvent(name,bubbles,cancelable,detail),event}},{}],22:[function(require,module){module.exports=function(fn,delay){var f=function(){f.timeout&&(clearTimeout(f.timeout),f.timeout=void 0),f.timeout=setTimeout(fn,delay)};return f}},{}],23:[function(require,module){var util=require("../util"),makeDirtyClean=require("../dirty-clean"),positionRange=require("../position-range");module.exports=function(_grid){var grid=_grid,dirtyClean=makeDirtyClean(grid),aliveDecorators=[],deadDecorators=[],decorators={add:function(decorator){aliveDecorators.push(decorator),dirtyClean.setDirty()},remove:function(decorators){util.isArray(decorators)||(decorators=[decorators]),decorators.forEach(function(decorator){var index=aliveDecorators.indexOf(decorator);-1!==index&&(aliveDecorators.splice(index,1),deadDecorators.push(decorator),dirtyClean.setDirty())})},getAlive:function(){return aliveDecorators.slice(0)},popAllDead:function(){var oldDead=deadDecorators;return deadDecorators=[],oldDead},isDirty:dirtyClean.isDirty,create:function(t,l,h,w,u,s){var decorator={},thisDirtyClean=makeDirtyClean(grid);return positionRange(decorator,thisDirtyClean,dirtyClean),decorator.top=t,decorator.left=l,decorator.height=h,decorator.width=w,decorator.units=u||decorator.units,decorator.space=s||decorator.space,decorator.render=function(){var div=document.createElement("div");return div.style.position="absolute",div.style.top="0px",div.style.left="0px",div.style.bottom="0px",div.style.right="0px",decorator.postRender&&decorator.postRender(div),div},decorator}};return decorators}},{"../dirty-clean":24,"../position-range":32,"../util":37}],24:[function(require,module){module.exports=function(_grid){var grid=_grid,dirty=!0;grid.eventLoop.bind("grid-draw",function(){api.setClean()});var api={isDirty:function(){return dirty},isClean:function(){return!dirty},setDirty:function(){dirty=!0,grid.requestDraw&&grid.requestDraw()},setClean:function(){dirty=!1}};return api}},{}],25:[function(require,module){var mousewheel=require("../mousewheel"),util=require("../util"),listeners=require("../listeners"),EVENTS=["click","mousedown","mouseup","mousemove","dblclick","keydown","keypress","keyup"],GRID_EVENTS=["grid-drag-start","grid-drag","grid-cell-drag","grid-drag-end"],eventLoop=function(_grid){function getHandlers(name){var handlers=handlersByName[name];return handlers||(handlers=handlersByName[name]=[]),handlers}function bindToDomElement(elem,name,listener){elem.addEventListener(name,listener);var unbindFn=function(){elem.removeEventListener(name,listener),domUnbindFns.splice(domUnbindFns.indexOf(unbindFn),1)};return domUnbindFns.push(unbindFn),unbindFn}function loopWith(fn){return function(e){loop(e,fn)}}function loop(e,bodyFn){var isOuterLoopRunning=eloop.isRunning;eloop.isRunning=!0,interceptors.notify(e),e.gridStopBubbling||bodyFn(e),isOuterLoopRunning||(eloop.isRunning=!1,exitListeners.notify(e))}var unbindAll,eloop={isRunning:!1},handlersByName={},domUnbindFns=[];eloop.setContainer=function(container){var unbindMouseWheelFn=mousewheel.bind(container,mainLoop);EVENTS.forEach(function(name){bindToDomElement(container,name,mainLoop)}),GRID_EVENTS.forEach(function(name){bindToDomElement(window,name,mainLoop)}),unbindAll=function(){unbindMouseWheelFn(),domUnbindFns.slice(0).forEach(function(unbind){unbind()})}},eloop.bind=function(){var args=Array.prototype.slice.call(arguments,0),name=args.filter(function(arg){return"string"==typeof arg})[0],handler=args.filter(function(arg){return"function"==typeof arg})[0];if(!handler||!name)throw"cannot bind without at least name and function";var elem=args.filter(function(arg){return util.isElement(arg)||arg===window||arg===document})[0];if(elem){var listener=loopWith(handler);return elem.style&&(elem.style.pointerEvents="all"),bindToDomElement(elem,name,listener)}return getHandlers(name).push(handler),function(){var handlers=getHandlers(name);handlers.splice(handlers.indexOf(handler),1)}},eloop.fire=function(event){event="string"==typeof event?{type:event}:event,mainLoop(event)};var interceptors=listeners(),exitListeners=listeners();eloop.addInterceptor=interceptors.addListener,eloop.addExitListener=exitListeners.addListener;var mainLoop=loopWith(function(e){getHandlers(e.type).slice(0).some(function(handler){return handler(e),e.gridStopBubbling?!0:void 0})});return eloop.bind("grid-destroy",function(){unbindAll(),eloop.destroyed=!0}),eloop.stopBubbling=function(e){return e.gridStopBubbling=!0,e},eloop};eventLoop.EVENTS=EVENTS,eventLoop.GRID_EVENTS=GRID_EVENTS,module.exports=eventLoop},{"../listeners":27,"../mousewheel":28,"../util":37}],26:[function(require,module){module.exports=function(_grid,model){function makeDecorator(col){var decorator=grid.decorators.create(0,col,1,1,"cell","real");return decorator.getDecoratorLeft=function(){var firstRect=decorator.boundingBox&&decorator.boundingBox.getClientRects()&&decorator.boundingBox.getClientRects()[0]||{};return grid.viewPort.toGridX(firstRect.left)||0},api.annotateDecorator&&api.annotateDecorator(decorator),decorator}function ensureDecoratorPerCol(){for(var c=0;c<grid.viewPort.cols;c++)if(!api._decorators[c]){var decorator=makeDecorator(c);api._decorators[c]=decorator,grid.decorators.add(decorator)}}var grid=_grid,api=model||{};return api._decorators={},grid.eventLoop.bind("grid-viewport-change",function(){ensureDecoratorPerCol()}),ensureDecoratorPerCol(),api}},{}],27:[function(require,module){module.exports=function(){var listeners=[];return{addListener:function(fn){return listeners.push(fn),function(){listeners.splice(listeners.indexOf(fn),1)}},notify:function(e){listeners.forEach(function(listener){listener(e)})}}}},{}],28:[function(require,module){function normalizeWheelEvent(e){var deltaX=api.getDelta(e,!0),deltaY=api.getDelta(e),newEvent=Object.create(e,{deltaY:{value:deltaY},deltaX:{value:deltaX},type:{value:"mousewheel"}});return newEvent.preventDefault=function(){newEvent.defaultPrevented=!0,e&&e.preventDefault&&e.preventDefault()},newEvent}var EVENT_NAMES=["mousewheel","wheel","DOMMouseScroll"],api={getDelta:function(event,xaxis){if(event.wheelDelta){var delta=event.wheelDeltaY;return xaxis&&(delta=event.wheelDeltaX),delta}if(event.detail){if(event.axis&&(1===event.axis&&xaxis||2===event.axis&&!xaxis))return-1*event.detail*12}else if(event.deltaX||event.deltaY)return xaxis?-1*event.deltaX:-1*event.deltaY;return 0},bind:function(elem,listener){var normalizedListener=function(e){listener(normalizeWheelEvent(e))};return EVENT_NAMES.forEach(function(name){elem.addEventListener(name,normalizedListener)}),function(){EVENT_NAMES.forEach(function(name){elem.removeEventListener(name,normalizedListener)})}},normalize:normalizeWheelEvent};module.exports=api},{}],29:[function(require,module){var key=require("key"),util=require("../util"),rangeUtil=require("../range-util");module.exports=function(_grid){function clampRowToMinMax(row){return util.clamp(row,0,grid.rowModel.length()-1)}function clampColToMinMax(col){return util.clamp(col,0,grid.colModel.length()-1)}function outsideMinMax(row,col){return 0>row||row>grid.rowModel.length()||0>col||col>grid.colModel.length()}function handleRowColSelectionChange(rowOrCol){var decoratorsField="_"+rowOrCol+"SelectionClasses";model[decoratorsField].forEach(function(selectionDecorator){grid.cellClasses.remove(selectionDecorator)}),model[decoratorsField]=[],grid[rowOrCol+"Model"].getSelected().forEach(function(index){var virtualIndex=grid[rowOrCol+"Model"].toVirtual(index),top="row"===rowOrCol?virtualIndex:0,left="col"===rowOrCol?virtualIndex:0,decorator=grid.cellClasses.create(top,left,"selected",1,1,"virtual");grid.cellClasses.add(decorator),model[decoratorsField].push(decorator)})}function clearSelection(){model.setSelection({top:-1,left:-1,height:-1,width:-1})}function setSelectionFromPoints(fromRow,fromCol,toRow,toCol){var newSelection=rangeUtil.createFromPoints(fromRow,fromCol,clampRowToMinMax(toRow),clampColToMinMax(toCol));model.setSelection(newSelection)}var grid=_grid,model={focus:{row:0,col:0}},focusClass=grid.cellClasses.create(0,0,"focus");grid.cellClasses.add(focusClass),model.focusDecorator=grid.decorators.create(0,0,1,1),model.focusDecorator.render=function(){var div=defaultRender();return div.setAttribute("class","grid-focus-decorator"),div},grid.decorators.add(model.focusDecorator),model.setFocus=function(row,col){row=clampRowToMinMax(row),col=clampColToMinMax(col),model.focus.row=row,model.focus.col=col,focusClass.top=row,focusClass.left=col,model.focusDecorator.top=row,model.focusDecorator.left=col,grid.cellScrollModel.scrollIntoView(row,col),clearSelection()},grid.eventLoop.bind("keydown",function(e){var arrow=key.code.arrow;if(key.is(arrow,e.which))if(e.shiftKey){var newSelection;switch(newSelection=-1===model.selection.top?{top:model.focus.row,left:model.focus.col,height:1,width:1}:{top:model.selection.top,left:model.selection.left,height:model.selection.height,width:model.selection.width},e.which){case arrow.down.code:model.focus.row===newSelection.top?newSelection.height++:(newSelection.top++,newSelection.height--);break;case arrow.up.code:model.focus.row===newSelection.top+newSelection.height-1?(newSelection.top--,newSelection.height++):newSelection.height--;break;case arrow.right.code:model.focus.col===newSelection.left?newSelection.width++:(newSelection.left++,newSelection.width--);break;case arrow.left.code:model.focus.col===newSelection.left+newSelection.width-1?(newSelection.left--,newSelection.width++):newSelection.width--}1===newSelection.height&&1===newSelection.width?clearSelection():model.setSelection(newSelection)}else{var navToRow=model.focus.row,navToCol=model.focus.col;switch(e.which){case arrow.down.code:navToRow++;break;case arrow.up.code:navToRow--;break;case arrow.right.code:navToCol++;
break;case arrow.left.code:navToCol--}model.setFocus(navToRow,navToCol,e)}}),grid.eventLoop.bind("mousedown",function(e){var row=e.row,col=e.col;0>row&&col>=0&&grid.colModel.toggleSelect(col),0>col&&row>=0&&grid.rowModel.toggleSelect(row),0>row&&0>col||(e.shiftKey?setSelectionFromPoints(model.focus.row,model.focus.col,row,col):model.setFocus(row,col,e))}),model._rowSelectionClasses=[],model._colSelectionClasses=[],grid.eventLoop.bind("grid-row-selection-change",function(){handleRowColSelectionChange("row")}),grid.eventLoop.bind("grid-col-selection-change",function(){handleRowColSelectionChange("col")});var selection=grid.decorators.create(),defaultRender=selection.render;return selection.render=function(){var div=defaultRender();return div.setAttribute("class","grid-selection"),div},grid.decorators.add(selection),model.setSelection=function(newSelection){selection.top=newSelection.top,selection.left=newSelection.left,selection.height=newSelection.height,selection.width=newSelection.width},selection._onDragStart=function(e){if(!outsideMinMax(e.row,e.col))var fromRow=model.focus.row,fromCol=model.focus.col,unbindDrag=grid.eventLoop.bind("grid-cell-drag",function(e){setSelectionFromPoints(fromRow,fromCol,e.row,e.col)}),unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(){unbindDrag(),unbindDragEnd()})},grid.eventLoop.bind("grid-drag-start",selection._onDragStart),clearSelection(),model.selection=selection,model}},{"../range-util":33,"../util":37,key:9}],30:[function(require,module){module.exports=function(){}},{}],31:[function(require,module){var util=require("../util"),debounce=require("../debounce"),capitalize=require("capitalize");module.exports=function(_grid){function cacheMaxScroll(){model.maxScroll.height=getMaxScroll("height"),model.maxScroll.width=getMaxScroll("width")}function notifyListeners(){grid.eventLoop.fire("grid-pixel-scroll");var scrollTop=model.top,row=grid.virtualPixelCellModel.getRow(scrollTop+grid.virtualPixelCellModel.fixedHeight())-grid.rowModel.numFixed(),scrollLeft=model.left,col=grid.virtualPixelCellModel.getCol(scrollLeft+grid.virtualPixelCellModel.fixedWidth())-grid.colModel.numFixed();grid.cellScrollModel.scrollTo(row,col,void 0,!0)}function getScrollPositionFromReal(scrollBarRealClickCoord,heightWidth,vertHorz){var scrollBarTopClick=scrollBarRealClickCoord-grid.virtualPixelCellModel["fixed"+capitalize(heightWidth)](),scrollRatio=scrollBarTopClick/getMaxScrollBarCoord(heightWidth,vertHorz),scrollCoord=scrollRatio*model.maxScroll[heightWidth];return scrollCoord}function makeScrollBarDecorator(isHorz){var decorator=grid.decorators.create(),xOrY=isHorz?"X":"Y",heightWidth=isHorz?"width":"height",vertHorz=isHorz?"horz":"vert",gridCoordField="grid"+xOrY,layerCoordField="layer"+xOrY,viewPortClampFn=grid.viewPort["clamp"+xOrY];return decorator.postRender=function(scrollBarElem){return scrollBarElem.setAttribute("class","grid-scroll-bar"),decorator._onDragStart=function(e){if(e.target===scrollBarElem){var scrollBarOffset=e[layerCoordField];decorator._unbindDrag=grid.eventLoop.bind("grid-drag",function(e){var gridCoord=viewPortClampFn(e[gridCoordField]),scrollBarRealClickCoord=gridCoord-scrollBarOffset,scrollCoord=getScrollPositionFromReal(scrollBarRealClickCoord,heightWidth,vertHorz);isHorz?model.scrollTo(model.top,scrollCoord):model.scrollTo(scrollCoord,model.left)}),decorator._unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(){decorator._unbindDrag(),decorator._unbindDragEnd()}),e.stopPropagation()}},grid.eventLoop.bind("grid-drag-start",scrollBarElem,decorator._onDragStart),grid.eventLoop.bind("mousedown",scrollBarElem,function(e){grid.eventLoop.stopBubbling(e)}),scrollBarElem},decorator.units="px",decorator.space="real",decorator}function getMaxScroll(heightWidth){for(var rowOrCol="height"===heightWidth?"row":"col",scrollLength=model[heightWidth],viewScrollHeightOrWidth=getViewScrollHeightOrWidth(heightWidth),firstScrollableCell=grid[rowOrCol+"Model"].numFixed();scrollLength>viewScrollHeightOrWidth-10;)scrollLength-=grid.virtualPixelCellModel[heightWidth](firstScrollableCell),firstScrollableCell++;return model[heightWidth]-scrollLength}function getScrollRatioFromVirtualScrollCoords(scroll,heightWidth){var maxScroll=model.maxScroll[heightWidth],scrollRatio=scroll/maxScroll;return scrollRatio}function getMaxScrollBarCoord(heightWidth,vertHorz){return getViewScrollHeightOrWidth(heightWidth)-model[vertHorz+"ScrollBar"][heightWidth]}function getRealScrollBarPosition(scroll,heightWidth,vertHorz){var scrollRatio=getScrollRatioFromVirtualScrollCoords(scroll,heightWidth),maxScrollBarScroll=getMaxScrollBarCoord(heightWidth,vertHorz),scrollBarCoord=scrollRatio*maxScrollBarScroll;return scrollBarCoord+grid.virtualPixelCellModel["fixed"+capitalize(heightWidth)]()}function calcScrollBarRealTop(){return getRealScrollBarPosition(model.top,"height","vert")}function calcScrollBarRealLeft(){return getRealScrollBarPosition(model.left,"width","horz")}function positionScrollBars(){model.vertScrollBar.top=calcScrollBarRealTop(),model.horzScrollBar.left=calcScrollBarRealLeft()}function getViewScrollHeightOrWidth(heightWidth){return grid.viewPort[heightWidth]-grid.virtualPixelCellModel["fixed"+capitalize(heightWidth)]()}function getScrollableViewWidth(){return getViewScrollHeightOrWidth("width")}function getScrollableViewHeight(){return getViewScrollHeightOrWidth("height")}function sizeScrollBars(){model.vertScrollBar.left=grid.viewPort.width-scrollBarWidth,model.horzScrollBar.top=grid.viewPort.height-scrollBarWidth;var scrollableViewHeight=getScrollableViewHeight(),scrollableViewWidth=getScrollableViewWidth();model.vertScrollBar.height=Math.max(scrollableViewHeight/grid.virtualPixelCellModel.totalHeight()*scrollableViewHeight,20),model.horzScrollBar.width=Math.max(scrollableViewWidth/grid.virtualPixelCellModel.totalWidth()*scrollableViewWidth,20),positionScrollBars()}var grid=_grid,model={top:0,left:0,maxScroll:{}},scrollBarWidth=10;grid.eventLoop.bind("grid-virtual-pixel-cell-change",function(){var scrollHeight=grid.virtualPixelCellModel.totalHeight()-grid.virtualPixelCellModel.fixedHeight(),scrollWidth=grid.virtualPixelCellModel.totalWidth()-grid.virtualPixelCellModel.fixedWidth();model.setScrollSize(scrollHeight,scrollWidth),cacheMaxScroll(),sizeScrollBars()}),grid.eventLoop.bind("grid-viewport-change",function(){cacheMaxScroll(),sizeScrollBars()}),grid.eventLoop.bind("mousewheel",function(e){var deltaY=e.deltaY,deltaX=e.deltaX;model.scrollTo(model.top-deltaY,model.left-deltaX,!0),debouncedNotify(),e.preventDefault()}),model.setScrollSize=function(h,w){model.height=h,model.width=w};var debouncedNotify=debounce(notifyListeners,1);return model.scrollTo=function(top,left,dontNotify){model.top=util.clamp(top,0,model.maxScroll.height),model.left=util.clamp(left,0,model.maxScroll.width),positionScrollBars(),dontNotify||notifyListeners()},model.vertScrollBar=makeScrollBarDecorator(),model.horzScrollBar=makeScrollBarDecorator(!0),model.vertScrollBar.width=scrollBarWidth,model.horzScrollBar.height=scrollBarWidth,model._getMaxScroll=getMaxScroll,model._getRealScrollBarPosition=getRealScrollBarPosition,model._getScrollPositionFromReal=getScrollPositionFromReal,grid.decorators.add(model.vertScrollBar),grid.decorators.add(model.horzScrollBar),model}},{"../debounce":22,"../util":37,capitalize:2}],32:[function(require,module){var addDirtyProps=require("../add-dirty-props");module.exports=function(range,dirtyClean,parentDirtyClean){range=range||{},range.isDirty=dirtyClean.isDirty;var watchedProperties=["top","left","height","width","units","space"],dirtyCleans=[dirtyClean];return parentDirtyClean&&dirtyCleans.push(parentDirtyClean),addDirtyProps(range,watchedProperties,dirtyCleans),range.units="cell",range.space="data",range}},{"../add-dirty-props":12}],33:[function(require,module){module.exports={intersect:function(range1,range2){var range2Start=range2[0],range1Start=range1[0],range1End=range1Start+range1[1]-1,range2End=range2Start+range2[1]-1;if(range2Start>range1End||range1Start>range2End)return null;var resultStart=range1Start>range2Start?range1Start:range2Start,resultEnd=range2End>range1End?range1End:range2End;return[resultStart,resultEnd-resultStart+1]},union:function(range1,range2){if(!range1)return range2;if(!range2)return range1;var range2Start=range2[0],range2End=range2Start+range2[1]-1,range1Start=range1[0],range1End=range1Start+range1[1]-1,resultStart=range2Start>range1Start?range1Start:range2Start;return[resultStart,(range1End>range2End?range1End:range2End)-resultStart+1]},createFromPoints:function(r1,c1,r2,c2){var range={};return r2>r1?(range.top=r1,range.height=r2-r1+1):(range.top=r2,range.height=r1-r2+1),c2>c1?(range.left=c1,range.width=c2-c1+1):(range.left=c2,range.width=c1-c2+1),range}}},{}],34:[function(require,module){module.exports=function(_grid){var grid=_grid,api=require("../abstract-row-col-model")(grid,"row","height",30);return api}},{"../abstract-row-col-model":11}],35:[function(require,module){module.exports=function(_grid){function setColShowing(col){grid.colModel.get(col).hidden=!1}function doWhileHidden(col,fn){for(;grid.colModel.get(col-1).hidden;)col--,fn&&fn(col);return col}function createDecorator(col,right){var headerDecorator=grid.decorators.create(0,col,1,1,"cell","virtual");return headerDecorator.postRender=function(div){right?(div.style.transform="translate(50%, -50%)",div.style.webkitTransform="translate(50%, -50%)",div.style.removeProperty("left")):(div.style.transform="translate(-50%, -50%)",div.style.webkitTransform="translate(-50%, -50%)",div.style.removeProperty("right")),div.style.removeProperty("bottom"),div.style.top="50%",div.setAttribute("class","show-hidden-cols"),grid.eventLoop.bind("click",div,function(){doWhileHidden(col,setColShowing)})},headerDecorator}var grid=_grid,api={_decorators:{}};return grid.eventLoop.bind("grid-col-change",function(e){("hide"===e.action||"add"===e.action)&&e.descriptors.forEach(function(descriptor){var col=descriptor.index;if(col||0===col)if(descriptor.hidden){var decCol=col+1,rightSide=col===grid.colModel.length(!0)-1;if(rightSide){var lastHiddenCol=doWhileHidden(col);decCol=lastHiddenCol-1}var decorator=createDecorator(decCol,rightSide);grid.decorators.add(decorator),api._decorators[col]=decorator}else{var decorator=api._decorators[col];grid.decorators.remove(decorator),api._decorators[col]=void 0}})}),api}},{}],36:[function(require,module){module.exports=function(_grid){var sortedCol,ascending,grid=_grid,cellData=[],headerData=[],dirtyClean=require("../dirty-clean")(grid),internalSet=function(data,r,c,datum){data[r]||(data[r]=[]),data[r][c]=datum,dirtyClean.setDirty()},api={isDirty:dirtyClean.isDirty,set:function(r,c,datum){internalSet(cellData,r,c,datum)},setHeader:function(r,c,datum){internalSet(headerData,r,c,datum)},get:function(r,c){var dataRow=cellData[grid.rowModel.row(r).dataRow],datum=dataRow&&dataRow[grid.colModel.col(c).dataCol],value=datum&&datum.value;return{value:value,formatted:value&&"r"+value[0]+" c"+value[1]||""}},getHeader:function(r,c){var dataRow=headerData[grid.rowModel.get(r).dataRow],datum=dataRow&&dataRow[grid.colModel.get(c).dataCol],value=datum&&datum.value;return{value:value,formatted:value&&"hr"+value[0]+" hc"+value[1]||""}},toggleSort:function(c){var retVal=-1,compareMethod=function(val1,val2){return val2>val1?retVal:-1*retVal};c===sortedCol?(ascending&&(retVal=1),ascending=!ascending):(sortedCol=c,ascending=!0),cellData.sort(function(dataRow1,dataRow2){return dataRow1&&dataRow1[c]?dataRow2&&dataRow2[c]?compareMethod(dataRow1[c].value,dataRow2[c].value):-1*retVal:retVal}),dirtyClean.setDirty()}};return api}},{"../dirty-clean":24}],37:[function(require,module){module.exports={clamp:function(num,min,max,returnNaN){return num>max?returnNaN?0/0:max:min>num?returnNaN?0/0:min:num},isNumber:function(number){return"number"==typeof number&&!isNaN(number)},isElement:function(node){return!(!node||!(node.nodeName||node.prop&&node.attr&&node.find))},isArray:function(value){return"[object Array]"===Object.prototype.toString.call(value)},position:function(elem,t,l,b,r){elem.style.top=t+"px",elem.style.left=l+"px",elem.style.bottom=b+"px",elem.style.right=r+"px",elem.style.position="absolute"}}},{}],38:[function(require,module){var customEvent=require("../custom-event"),debounce=require("../debounce"),util=require("../util");module.exports=function(_grid){function measureBorderWidth(){if(!borderWidth){var jsGridCell=cells[0]&&cells[0][0];if(jsGridCell){var oldClass=jsGridCell.className;jsGridCell.className=CELL_CLASS;var computedStyle=getComputedStyle(jsGridCell),borderWidthProp=computedStyle.getPropertyValue("border-left-width");borderWidth=parseInt(borderWidthProp),jsGridCell.className=oldClass}return borderWidth=isNaN(borderWidth)||!borderWidth?void 0:borderWidth}}function getBorderWidth(){return borderWidth||1}function buildDivCell(){var cell=document.createElement("div");cell.setAttribute("dts","grid-cell");var style=cell.style;return style.position="absolute",style.boxSizing="border-box",style.top="0px",style.bottom="0px",cell}function setPosition(boundingBox,top,left,height,width){var style=boundingBox.style;return 0>=height||0>=width?void(style.display="none"):(style.display="",style.top=top+"px",style.left=left+"px",style.height=height+"px",style.width=width+"px",void(style.position="absolute"))}function positionDecorator(bounding,t,l,h,w){setPosition(bounding,t,l,util.clamp(h,0,grid.viewPort.height),util.clamp(w,0,grid.viewPort.width))}function positionCellDecoratorFromViewCellRange(realCellRange,boundingBox){var realPxRange=grid.viewPort.toPx(realCellRange);positionDecorator(boundingBox,realPxRange.top,realPxRange.left,realPxRange.height&&realPxRange.height+getBorderWidth(),realPxRange.width&&realPxRange.width+getBorderWidth())}function createRangeForDescriptor(descriptor){var range={top:descriptor.top,left:descriptor.left,height:descriptor.height,width:descriptor.width};return"data"===descriptor.space&&"cell"===descriptor.units&&(range.top+=grid.rowModel.numHeaders(),range.left+=grid.colModel.numHeaders()),range}function removeDecorators(decorators){decorators.forEach(function(decorator){var boundingBox=decorator.boundingBox;if(boundingBox){var renderedElement=boundingBox.firstChild;if(renderedElement){var destroyEvent=customEvent("decorator-destroy",!0);renderedElement.dispatchEvent(destroyEvent)}decoratorContainer.removeChild(boundingBox),decorator.boundingBox=void 0}})}function cleanup(){if(removeDecorators(grid.decorators.getAlive().concat(grid.decorators.popAllDead())),container)for(var querySelectorAll=container.querySelectorAll("."+GRID_VIEW_ROOT_CLASS),i=0;i<querySelectorAll.length;++i){var root=querySelectorAll[i];container.removeChild(root)}}var container,root,cellContainer,decoratorContainer,borderWidth,cells,rows,builtCols,builtRows,viewLayer={},grid=_grid,GRID_CELL_CONTAINER_BASE_CLASS="grid-cells",GRID_VIEW_ROOT_CLASS="js-grid-view-root",CELL_CLASS="grid-cell";grid.cellClasses.add(grid.cellClasses.create(0,0,CELL_CLASS,1/0,1/0,"virtual"));var rowHeaderClasses=grid.cellClasses.create(0,0,"grid-header grid-row-header",1/0,0,"virtual"),colHeaderClasses=grid.cellClasses.create(0,0,"grid-header grid-col-header",0,1/0,"virtual"),fixedColClasses=grid.cellClasses.create(0,-1,"grid-last-fixed-col",1/0,1,"virtual"),fixedRowClasses=grid.cellClasses.create(-1,0,"grid-last-fixed-row",1,1/0,"virtual");return grid.cellClasses.add(rowHeaderClasses),grid.cellClasses.add(colHeaderClasses),grid.cellClasses.add(fixedRowClasses),grid.cellClasses.add(fixedColClasses),grid.eventLoop.bind("grid-col-change",function(){fixedColClasses.left=grid.colModel.numFixed()-1,rowHeaderClasses.width=grid.colModel.numHeaders()}),grid.eventLoop.bind("grid-row-change",function(){fixedRowClasses.top=grid.rowModel.numFixed()-1,colHeaderClasses.height=grid.rowModel.numHeaders()}),viewLayer.build=function(elem){cleanup(),container=elem,cellContainer=document.createElement("div"),cellContainer.setAttribute("dts","grid-cells"),cellContainer.setAttribute("class",GRID_CELL_CONTAINER_BASE_CLASS),util.position(cellContainer,0,0,0,0),cellContainer.style.zIndex=0,decoratorContainer=document.createElement("div"),decoratorContainer.setAttribute("dts","grid-decorators"),util.position(decoratorContainer,0,0,0,0),decoratorContainer.style.zIndex=0,decoratorContainer.style.pointerEvents="none",root=document.createElement("div"),root.setAttribute("class",GRID_VIEW_ROOT_CLASS),root.appendChild(cellContainer),root.appendChild(decoratorContainer),container.appendChild(root)},viewLayer.draw=debounce(function(){viewLayer._draw()},1),viewLayer._draw=function(){if(container){var rebuilt=grid.viewPort.isDirty();rebuilt&&viewLayer._buildCells(cellContainer);var builtColsDirty=grid.colModel.areBuildersDirty();(rebuilt||builtColsDirty)&&viewLayer._buildCols();var builtRowsDirty=grid.rowModel.areBuildersDirty();(rebuilt||builtRowsDirty)&&viewLayer._buildRows();var cellsPositionOrSizeChanged=grid.colModel.isDirty()||grid.rowModel.isDirty()||grid.cellScrollModel.isDirty();(grid.cellClasses.isDirty()||rebuilt||cellsPositionOrSizeChanged)&&viewLayer._drawCellClasses(),(rebuilt||cellsPositionOrSizeChanged||builtColsDirty||builtRowsDirty||grid.dataModel.isDirty())&&viewLayer._drawCells(),(grid.decorators.isDirty()||rebuilt||cellsPositionOrSizeChanged)&&viewLayer._drawDecorators(cellsPositionOrSizeChanged),grid.eventLoop.fire("grid-draw")}},viewLayer._drawCells=function(){measureBorderWidth();var lastVirtualCol,bWidth=getBorderWidth(),headerRows=grid.rowModel.numHeaders(),headerCols=grid.colModel.numHeaders(),totalVisibleCellWidth=0;grid.viewPort.iterateCells(function(r,c){var cell=cells[r][c],width=grid.viewPort.getColWidth(c),virtualCol=grid.viewPort.toVirtualCol(c);if(0==width||virtualCol===lastVirtualCol)return void(cell.style.display="none");0===r&&(totalVisibleCellWidth+=width),lastVirtualCol=virtualCol,cell.style.display="",cell.style.width=width+bWidth+"px";var left=grid.viewPort.getColLeft(c);for(cell.style.left=left+"px";cell.firstChild;)cell.removeChild(cell.firstChild);var data,virtualRow=grid.viewPort.toVirtualRow(r);data=headerRows>r||headerCols>c?grid.dataModel.getHeader(virtualRow,virtualCol):grid.dataModel.get(grid.rowModel.toData(virtualRow),grid.colModel.toData(virtualCol));var builder=headerRows>virtualRow&&grid.rowModel.get(virtualRow).builder||void 0,hasRowBuilder=!0;builder||(hasRowBuilder=!1,builder=grid.colModel.get(virtualCol).builder);var cellChild;if(builder){var builtElem;builtElem=hasRowBuilder?builtRows[virtualRow][c]:builtCols[virtualCol][r],cellChild=builder.update(builtElem,{virtualCol:virtualCol,virtualRow:virtualRow,data:data})}cellChild||(cellChild=document.createTextNode(data.formatted)),cell.appendChild(cellChild)},function(r){var height=grid.viewPort.getRowHeight(r),row=rows[r];if(0==height)return void(row.style.display="none");row.style.display="",row.style.height=height+bWidth+"px";var top=grid.viewPort.getRowTop(r);row.style.top=top+"px"}),rows.forEach(function(row){row.style.width=totalVisibleCellWidth+"px"}),cellContainer.className=grid.cellScrollModel.row%2?GRID_CELL_CONTAINER_BASE_CLASS+" odds":GRID_CELL_CONTAINER_BASE_CLASS},viewLayer._buildCells=function(cellContainer){for(;cellContainer.firstChild;)cellContainer.removeChild(cellContainer.firstChild);cells=[],rows=[];var row;grid.viewPort.iterateCells(function(r,c){var cell=buildDivCell();cells[r][c]=cell,row.appendChild(cell)},function(r){cells[r]=[],row=document.createElement("div"),row.setAttribute("class","grid-row"),row.setAttribute("dts","grid-row"),row.style.position="absolute",row.style.left=0,rows[r]=row,cellContainer.appendChild(row)})},viewLayer._buildCols=function(){builtCols={};for(var c=0;c<grid.colModel.length(!0);c++){var builder=grid.colModel.get(c).builder;if(builder){builtCols[c]=[];for(var realRow=0;realRow<grid.viewPort.rows;realRow++)builtCols[c][realRow]=builder.render()}}},viewLayer._buildRows=function(){builtRows={};for(var r=0;r<grid.rowModel.numHeaders();r++){var builder=grid.rowModel.get(r).builder;if(builder){builtRows[r]=[];for(var realCol=0;realCol<grid.viewPort.cols;realCol++)builtRows[r][realCol]=builder.render()}}},viewLayer._drawDecorators=function(cellsPositionOrSizeChanged){var aliveDecorators=grid.decorators.getAlive();aliveDecorators.forEach(function(decorator){var boundingBox=decorator.boundingBox;if(!boundingBox){boundingBox=document.createElement("div"),boundingBox.style.pointerEvents="none",decorator.boundingBox=boundingBox;var decElement=decorator.render();decElement&&(boundingBox.appendChild(decElement),decoratorContainer.appendChild(boundingBox))}if(decorator.isDirty()||cellsPositionOrSizeChanged)if("real"===decorator.space)switch(decorator.units){case"px":positionDecorator(boundingBox,decorator.top,decorator.left,decorator.height,decorator.width);break;case"cell":positionCellDecoratorFromViewCellRange(decorator,boundingBox)}else if("virtual"===decorator.space||"data"===decorator.space)switch(decorator.units){case"px":break;case"cell":default:var range=createRangeForDescriptor(decorator),realCellRange=grid.viewPort.intersect(range);realCellRange?positionCellDecoratorFromViewCellRange(realCellRange,boundingBox):positionDecorator(boundingBox,-1,-1,-1,-1)}}),removeDecorators(grid.decorators.popAllDead())},viewLayer._drawCellClasses=function(){grid.viewPort.iterateCells(function(r,c){cells[r][c].className=""}),grid.cellClasses.getAll().forEach(function(descriptor){var range=createRangeForDescriptor(descriptor),intersection=grid.viewPort.intersect(range);if(intersection)rowLoop:for(var r=0;r<intersection.height;r++)for(var c=0;c<intersection.width;c++){var row=intersection.top+r,col=intersection.left+c,cellRow=cells[row];if(!cellRow)continue rowLoop;var cell=cellRow[col];cell&&(cell.className=(cell.className?cell.className+" ":"")+descriptor.class)}})},viewLayer.destroy=cleanup,grid.eventLoop.bind("grid-destroy",function(){viewLayer.destroy(),clearTimeout(viewLayer.draw.timeout)}),viewLayer}},{"../custom-event":21,"../debounce":22,"../util":37}],39:[function(require,module){var util=require("../util"),rangeUtil=require("../range-util"),capitalize=require("capitalize"),addDirtyProps=require("../add-dirty-props"),debounce=require("../debounce");module.exports=function(_grid){function getFirstClientRect(){return container&&container.getClientRects&&container.getClientRects()&&container.getClientRects()[0]||{}}function getFixed(rowOrCol){return fixed[rowOrCol+"s"]}function convertRealToVirtual(coord,rowOrCol,coordIsVirtual){var numFixed=getFixed(rowOrCol);return numFixed>coord?coord:coord+(coordIsVirtual?-1:1)*grid.cellScrollModel[rowOrCol]}function getVirtualRowColUnsafe(realCoord,rowOrCol){return convertRealToVirtual(realCoord,rowOrCol)}function getVirtualRowColClamped(viewCoord,rowOrCol){var virtualRowCol=getVirtualRowColUnsafe(viewCoord,rowOrCol);return grid.virtualPixelCellModel["clamp"+capitalize(rowOrCol)](virtualRowCol)}function getRealRowColClamped(virtualCoord,rowOrCol){var numFixed=getFixed(rowOrCol);if(numFixed>virtualCoord)return virtualCoord;var maxViewPortIndex=viewPort[rowOrCol+"s"]-1;return util.clamp(virtualCoord-grid.cellScrollModel[rowOrCol],numFixed,maxViewPortIndex,!0)}function getLengthBetweenViewCoords(startCoord,endCoord,rowOrCol,heightOrWidth,inclusive){var rowOrColCap=capitalize(rowOrCol),toVirtual=viewPort["toVirtual"+rowOrColCap],lengthFn=grid.virtualPixelCellModel[heightOrWidth],clampFn=viewPort["clamp"+rowOrColCap],pos=0,numFixed=getFixed(rowOrCol),isInNonfixedArea=endCoord>=numFixed,isInFixedArea=numFixed>startCoord,exclusiveOffset=inclusive?0:1;if(isInFixedArea){var fixedEndCoord=isInNonfixedArea?numFixed-1:endCoord-exclusiveOffset;pos+=lengthFn(startCoord,fixedEndCoord)}return isInNonfixedArea&&(pos+=lengthFn(toVirtual(isInFixedArea?numFixed:startCoord),toVirtual(clampFn(endCoord))-exclusiveOffset)),pos}function getTopOrLeft(endCoord,rowOrCol,heightOrWidth){return getLengthBetweenViewCoords(0,endCoord,rowOrCol,heightOrWidth)}function getRowOrColFromPosition(pos,rowOrCol,heightOrWidth,returnVirtual){for(var rowOrColCap=capitalize(rowOrCol),viewMax=viewPort[rowOrCol+"s"],toVirtual=viewPort["toVirtual"+rowOrColCap],lengthFn=grid.virtualPixelCellModel[heightOrWidth],summedLength=0,i=0;viewMax>i;i++){var virtual=toVirtual(i),length=lengthFn(virtual),newSum=summedLength+length;if(newSum>pos)return returnVirtual?virtual:i;summedLength=newSum}return 0/0}function intersectRowsOrCols(intersection,range,topOrLeft,rowOrCol,heightOrWidth){var numFixed=fixed[rowOrCol+"s"],fixedRange=[0,numFixed],virtualRange=[range[topOrLeft],range[heightOrWidth]],fixedIntersection=rangeUtil.intersect(fixedRange,virtualRange),scrollRange=[numFixed,viewPort[rowOrCol+"s"]-numFixed];virtualRange[0]-=grid.cellScrollModel[rowOrCol];var scrollIntersection=rangeUtil.intersect(scrollRange,virtualRange),resultRange=rangeUtil.union(fixedIntersection,scrollIntersection);return resultRange?(intersection[topOrLeft]=resultRange[0],intersection[heightOrWidth]=resultRange[1],intersection):null}function calculateMaxLengths(totalLength,lengthModel){for(var lengthMethod=lengthModel.width&&grid.virtualPixelCellModel.width||grid.virtualPixelCellModel.height,numFixed=lengthModel.numFixed(),windowLength=0,maxSize=0,fixedLength=0,windowStartIndex=numFixed,fixed=0;numFixed>fixed;fixed++)fixedLength+=lengthMethod(fixed);for(var index=numFixed;index<lengthModel.length(!0);index++){var lengthOfIindex=lengthMethod(index);for(windowLength+=lengthOfIindex;windowLength+fixedLength>totalLength&&index>windowStartIndex;)windowLength-=lengthMethod(windowStartIndex),windowStartIndex++;var windowSize=index-windowStartIndex+1;windowSize>maxSize&&(maxSize=windowSize)}return maxSize+numFixed+1}var container,grid=_grid,dirtyClean=require("../dirty-clean")(grid),viewPort=addDirtyProps({},["rows","cols","width","height"],[dirtyClean]);viewPort.rows=0,viewPort.cols=0,viewPort.isDirty=dirtyClean.isDirty,Object.defineProperty(viewPort,"top",{enumerable:!0,get:function(){return getFirstClientRect().top||0}}),Object.defineProperty(viewPort,"left",{enumerable:!0,get:function(){return getFirstClientRect().left||0}}),viewPort.toGridX=function(clientX){return clientX-viewPort.left},viewPort.toGridY=function(clientY){return clientY-viewPort.top};var fixed={rows:0,cols:0};viewPort.sizeToContainer=function(elem){container=elem,viewPort.width=elem.offsetWidth,viewPort.height=elem.offsetHeight,viewPort.rows=calculateMaxLengths(viewPort.height,grid.rowModel),viewPort.cols=calculateMaxLengths(viewPort.width,grid.colModel),grid.eventLoop.fire("grid-viewport-change")},viewPort._onResize=debounce(function(){viewPort._resize()},200),grid.eventLoop.bind("grid-destroy",function(){clearTimeout(viewPort._onResize.timeout),clearTimeout(shortDebouncedResize.timeout)}),viewPort._resize=function(){container&&viewPort.sizeToContainer(container)};var shortDebouncedResize=debounce(function(){viewPort._resize()},1);return viewPort.shortDebouncedResize=shortDebouncedResize,grid.eventLoop.bind("resize",window,function(){viewPort._onResize()}),grid.eventLoop.bind("grid-row-change",function(){fixed.rows=grid.rowModel.numFixed(),shortDebouncedResize()}),grid.eventLoop.bind("grid-col-change",function(){fixed.cols=grid.colModel.numFixed(),shortDebouncedResize()}),viewPort.toVirtualRow=function(r){return getVirtualRowColClamped(r,"row")},viewPort.toVirtualCol=function(c){return getVirtualRowColClamped(c,"col")},viewPort.rowIsInView=function(virtualRow){var realRow=viewPort.toRealRow(virtualRow);return!isNaN(realRow)&&getLengthBetweenViewCoords(0,realRow,"row","height",!0)<viewPort.height},viewPort.colIsInView=function(virtualCol){var realCol=viewPort.toRealCol(virtualCol);return!isNaN(realCol)&&getLengthBetweenViewCoords(0,realCol,"col","width",!0)<viewPort.width},viewPort.toRealRow=function(virtualRow){return getRealRowColClamped(virtualRow,"row")},viewPort.toRealCol=function(virtualCol){return getRealRowColClamped(virtualCol,"col")},viewPort.clampRow=function(r){return util.clamp(r,0,viewPort.rows-1)},viewPort.clampCol=function(c){return util.clamp(c,0,viewPort.cols-1)},viewPort.clampY=function(y){return util.clamp(y,0,viewPort.height)},viewPort.clampX=function(x){return util.clamp(x,0,viewPort.width)},viewPort.getRowTop=function(viewPortCoord){return getTopOrLeft(viewPortCoord,"row","height")},viewPort.getColLeft=function(viewPortCol){return getTopOrLeft(viewPortCol,"col","width")},viewPort.toPx=function(realCellRange){return{top:viewPort.getRowTop(realCellRange.top),left:viewPort.getColLeft(realCellRange.left),height:getLengthBetweenViewCoords(realCellRange.top,realCellRange.top+realCellRange.height-1,"row","height",!0),width:getLengthBetweenViewCoords(realCellRange.left,realCellRange.left+realCellRange.width-1,"col","width",!0)}},viewPort.getVirtualRowByTop=function(top){return getRowOrColFromPosition(top,"row","height",!0)},viewPort.getVirtualColByLeft=function(left){return getRowOrColFromPosition(left,"col","width",!0)},viewPort.getRowByTop=function(top){return getRowOrColFromPosition(top,"row","height")},viewPort.getColByLeft=function(left){return getRowOrColFromPosition(left,"col","width")},viewPort.getRowHeight=function(viewPortRow){return grid.virtualPixelCellModel.height(viewPort.toVirtualRow(viewPort.clampRow(viewPortRow)))},viewPort.getColWidth=function(viewPortCol){return grid.virtualPixelCellModel.width(viewPort.toVirtualCol(viewPort.clampCol(viewPortCol)))},viewPort.intersect=function(range){var intersection=intersectRowsOrCols({},range,"top","row","height");return intersection?intersectRowsOrCols(intersection,range,"left","col","width"):null},viewPort.iterateCells=function(cellFn,optionalRowFn,optionalMaxRow,optionalMaxCol){optionalMaxRow=optionalMaxRow||1/0,optionalMaxCol=optionalMaxCol||1/0;for(var r=0;r<Math.min(viewPort.rows,optionalMaxRow);r++)if(optionalRowFn&&optionalRowFn(r),cellFn)for(var c=0;c<Math.min(viewPort.cols,optionalMaxCol);c++)cellFn(r,c)},viewPort}},{"../add-dirty-props":12,"../debounce":22,"../dirty-clean":24,"../range-util":33,"../util":37,capitalize:2}],40:[function(require,module){var util=require("../util");module.exports=function(_grid){function clampRowOrCol(virtualRowCol,rowOrCol){var maxRowCol=grid[rowOrCol+"Model"].length(!0)-1;return util.clamp(virtualRowCol,0,maxRowCol)}function heightOrWidth(start,end,rowOrCol){var length=0;if(start>end)return 0;end=util.isNumber(end)?end:start,end=clampRowOrCol(end,rowOrCol),start=clampRowOrCol(start,rowOrCol);for(var lengthModel=grid[rowOrCol+"Model"],lengthFn=lengthModel.width||lengthModel.height,i=start;end>=i;i++)length+=lengthFn(i);return length}function sizeChangeListener(){grid.eventLoop.fire("grid-virtual-pixel-cell-change")}var grid=_grid,model={};return model.getRow=function(topPx){if(0>topPx)return 0/0;for(var sumLength=0,r=0;r<grid.rowModel.length(!0);r++)if(sumLength+=grid.rowModel.height(r),sumLength>topPx)return r;return 0/0},model.getCol=function(leftPx){if(0>leftPx)return 0/0;for(var sumLength=0,c=0;c<grid.colModel.length(!0);c++)if(sumLength+=grid.colModel.width(c),sumLength>leftPx)return c;return 0/0},model.clampRow=function(virtualRow){return clampRowOrCol(virtualRow,"row")},model.clampCol=function(virtualCol){return clampRowOrCol(virtualCol,"col")},model.height=function(virtualRowStart,virtualRowEnd){return heightOrWidth(virtualRowStart,virtualRowEnd,"row")},model.width=function(virtualColStart,virtualColEnd){return heightOrWidth(virtualColStart,virtualColEnd,"col")},model.totalHeight=function(){return model.height(0,grid.rowModel.length(!0)-1)},model.totalWidth=function(){return model.width(0,grid.colModel.length(!0)-1)},model.fixedHeight=function(){return model.height(0,grid.rowModel.numFixed()-1)},model.fixedWidth=function(){return model.width(0,grid.colModel.numFixed()-1)},grid.eventLoop.bind("grid-col-change",sizeChangeListener),grid.eventLoop.bind("grid-row-change",sizeChangeListener),model}},{"../util":37}]},{},[1]);